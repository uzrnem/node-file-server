<!DOCTYPE html>
<html lang="en">
<head>
  <title>File Explorer</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.1/css/bootstrap.min.css" integrity="sha512-T584yQ/tdRR5QwOpfvDfVQUidzfgc2339Lc8uBDtcp/wYu80d7jwBgAxbyMh0a9YM9F8N3tdErpFI8iaGx6x5g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js" integrity="sha512-bPh3uwgU5qEMipS/VOmRqynnMXGGSRv+72H/N260MQeXZIK4PG48401Bsby9Nq5P5fz7hy5UGNmC/W1Z51h2GQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.1/js/bootstrap.min.js" integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.14/vue.min.js" integrity="sha512-XdUZ5nrNkVySQBnnM5vzDqHai823Spoq1W3pJoQwomQja+o4Nw0Ew1ppxo5bhF2vMug6sfibhKWcNJsG8Vj9tg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <style>
  </style>
</head>
<body>
  <div class="container" id="vue-app">
    <div class="col-12">
      <h3>Upload File</h3>
      <!-- div class="input-group my-3">
        <div class="input-group-prepend">
          <span class="input-group-text" id="inputGroupFileAddon01">Upload</span>
        </div>
        <div class="custom-file">
          <input type="file" class="custom-file-input" id="inputGroupFile01" aria-describedby="inputGroupFileAddon01">
          <label class="custom-file-label" for="inputGroupFile01">Choose file</label>
        </div>
      </div -->
      <div class="bd-example">          
        <div class="input-group">
          <input type="file" class="form-control" id="file" ref="file" v-on:change="setupFile()">
          <a class="btn btn-primary" v-on:click="submitFile()">Upload</a>
        </div>
      </div>
    </div>
    <div class="col-12">
      <br />
      <table class="table table-striped">
        <thead>
          <tr>
            <th></th>
            <th>File</th>
            <th>Download</th>
            <th>Delete</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="item in list">
            <td></td>
            <td><span class="t-orange">{{item}}</span></td>
            <td>
              <a class="btn btn-secondary" :href="'/' + item" target="_blank" >Download</a>
            </td>
            <td>
              <a class="btn btn-warning" @click="deleteItem(item)" >Delete</a>
            </td>
            <td></td>
          </tr>
          <tr>
            <td colspan="6" v-if="list.length == 0">
              <p class="t-blue text-center">No Records Found!</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</body>

  <script>
    var app = new Vue({
      el: '#vue-app',
      data: {
        model: {},
        list: [],
        file: null
      },
      created() {
          console.log('Component has been created!');
      },
      methods: {
        deleteItem: function(item) {
          console.log(item)
          axios.get('/delete/'+item )
          .then((response) => {
            console.log('deleted: ', item, ', response: ', response)
            this.clear();
          });
        },
        getList: function() {
          axios.get('/list')
          .then((response) => {
            this.list = response.data;
            console.log(this.list)
          });
        },
        submitFile: function() {
          let formData = new FormData();
          formData.append('file', this.file);
          axios.post( '/upload/'+this.file.name,
            formData,
            {
              headers: {
                'Content-Type': 'multipart/form-data'
              },
              onUploadProgress: (progressEvent) => {
                var percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total)
                console.log(percentCompleted)
              }
            }
          )
          .then(() => { 
            console.log('passed: ', this.file.name)
            this.clear();
          })
          .catch(() => {
            console.log('failed: ', this.file.name)
            this.clear();
          });
        },
        setupFile: function() {
          this.file = this.$refs.file.files[0];
          console.log(this.file)
        },
        clear: function() {
          this.model = {
          };
          this.getList();
        }
      },
      mounted() {
        console.log('Component has been Mounted!');
        this.clear();
      }
    });
  </script>
</html>